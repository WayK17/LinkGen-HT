<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="" />
    <link
      rel="stylesheet"
      as="style"
      onload="this.rel='stylesheet'"
      href="https://fonts.googleapis.com/css2?display=swap&family=Noto+Sans%3Awght%40400%3B500%3B700%3B900&family=Space+Grotesk%3Awght%40400%3B500%3B700"
    />

    <title>LinkGen Universal</title>
    <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64," />

    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  </head>
  <body class="bg-[#101323]">
    <div
      class="relative flex size-full min-h-screen flex-col bg-[#101323] dark justify-between group/design-root overflow-x-hidden"
      style='font-family: "Space Grotesk", "Noto Sans", sans-serif;'
    >
      <div>
        <header class="flex items-center p-4 pb-2 justify-between">
          <div class="text-white flex size-12 shrink-0 items-center">
            <svg xmlns="http://www.w3.org/2000/svg" width="28px" height="28px" fill="currentColor" viewBox="0 0 256 256">
              <path
                d="M137.54,186.36a8,8,0,0,1,0,11.31l-9.94,10A56,56,0,0,1,48.38,128.4L72.5,104.28A56,56,0,0,1,149.31,102a8,8,0,1,1-10.64,12,40,40,0,0,0-54.85,1.63L59.7,139.72a40,40,0,0,0,56.58,56.58l9.94-9.94A8,8,0,0,1,137.54,186.36Zm70.08-138a56.08,56.08,0,0,0-79.22,0l-9.94,9.95a8,8,0,0,0,11.32,11.31l9.94-9.94a40,40,0,0,1,56.58,56.58L172.18,140.4A40,40,0,0,1,117.33,142,8,8,0,1,0,106.69,154a56,56,0,0,0,76.81-2.26l24.12-24.12A56.08,56.08,0,0,0,207.62,48.38Z"
              ></path>
            </svg>
          </div>
          <h2 class="text-white text-lg font-bold leading-tight tracking-[-0.015em] flex-1">LinkGen Universal</h2>
        </header>

        <main class="flex flex-col items-center px-4">
          <h1 class="text-white tracking-light text-[32px] font-bold leading-tight text-center pb-3 pt-6">Generador de Enlaces Universal</h1>
          <p class="text-[#8e99cc] text-base font-normal leading-normal pb-3 pt-1 text-center max-w-md">Pega cualquier enlace para obtener descargas directas sin esperas.</p>

          <div class="w-full max-w-lg flex flex-col items-center">
              <div class="flex w-full flex-wrap items-end gap-4 px-4 py-3">
                <label class="flex flex-col min-w-40 flex-1">
                  <div class="flex w-full flex-1 items-stretch rounded-xl">
                    <input
                      id="universal-link-input"
                      placeholder="Pega tu enlace aquí..."
                      class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-white focus:outline-0 focus:ring-2 focus:ring-[#607afb] border-none bg-[#21284a] h-14 placeholder:text-[#8e99cc] p-4 rounded-r-none border-r-0 pr-2 text-base font-normal leading-normal"
                    />
                    <div class="text-[#8e99cc] flex border-none bg-[#21284a] items-center justify-center pr-4 rounded-r-xl border-l-0">
                      <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256"><path d="M137.54,186.36a8,8,0,0,1,0,11.31l-9.94,10A56,56,0,0,1,48.38,128.4L72.5,104.28A56,56,0,0,1,149.31,102a8,8,0,1,1-10.64,12,40,40,0,0,0-54.85,1.63L59.7,139.72a40,40,0,0,0,56.58,56.58l9.94-9.94A8,8,0,0,1,137.54,186.36Zm70.08-138a56.08,56.08,0,0,0-79.22,0l-9.94,9.95a8,8,0,0,0,11.32,11.31l9.94-9.94a40,40,0,0,1,56.58,56.58L172.18,140.4A40,40,0,0,1,117.33,142,8,8,0,1,0,106.69,154a56,56,0,0,0,76.81-2.26l24.12-24.12A56.08,56.08,0,0,0,207.62,48.38Z"></path></svg>
                    </div>
                  </div>
                </label>
              </div>
              <div class="flex w-full px-4 py-3 justify-center">
                <button
                  id="generate-button"
                  class="flex w-full min-w-[84px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-12 px-4 bg-[#607afb] hover:bg-opacity-90 transition-all text-white text-base font-bold leading-normal tracking-[0.015em] disabled:bg-gray-500 disabled:cursor-not-allowed"
                >
                  <span class="truncate">Generar Enlace</span>
                </button>
              </div>
          </div>

          <div id="results-container" class="p-4 w-full max-w-lg mt-4">
            </div>
        </main>
      </div>

      <footer class="flex flex-col items-center gap-6 px-5 py-10 text-center @container">
        <a href="https://github.com/WayK17/Mediafire-Links" target="_blank" rel="noopener noreferrer" class="text-[#8e99cc] hover:text-white transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" width="28px" height="28px" fill="currentColor" viewBox="0 0 256 256"><path d="M208.31,75.68A59.78,59.78,0,0,0,202.93,28,8,8,0,0,0,196,24a59.75,59.75,0,0,0-48,24H124A59.75,59.75,0,0,0,76,24a8,8,0,0,0-6.93,4,59.78,59.78,0,0,0-5.38,47.68A58.14,58.14,0,0,0,56,104v8a56.06,56.06,0,0,0,48.44,55.47A39.8,39.8,0,0,0,96,192v8H72a24,24,0,0,1-24-24A40,40,0,0,0,8,136a8,8,0,0,0,0,16,24,24,0,0,1,24,24,40,40,0,0,0,40,40H96v16a8,8,0,0,0,16,0V192a24,24,0,0,1,48,0v40a8,8,0,0,0,16,0V192a39.8,39.8,0,0,0-8.44-24.53A56.06,56.06,0,0,0,216,112v-8A58.14,58.14,0,0,0,208.31,75.68ZM200,112a40,40,0,0,1-40,40H112a40,40,0,0,1-40-40v-8a41.74,41.74,0,0,1,6.9-22.48A8,8,0,0,0,80,73.83a43.81,43.81,0,0,1,.79-33.58,43.88,43.88,0,0,1,32.32,20.06A8,8,0,0,0,119.82,64h32.35a8,8,0,0,0,6.74-3.69,43.87,43.87,0,0,1,32.32-20.06A43.81,43.81,0,0,1,192,73.83a8.09,8.09,0,0,0,1,7.65A41.72,41.72,0,0,1,200,104Z"></path></svg>
        </a>
        <p class="text-[#8e99cc] text-base font-normal leading-normal">© 2025 LinkGen Universal. Todos los derechos reservados.</p>
      </footer>
    </div>
    <script>
      const generateButton = document.getElementById('generate-button');
      const linkInput = document.getElementById('universal-link-input');
      const resultsContainer = document.getElementById('results-container');

      generateButton.addEventListener('click', async () => {
        const url = linkInput.value;
        if (!url) {
          resultsContainer.innerHTML = `<div class="p-3 rounded-xl bg-red-900 bg-opacity-50 border border-red-500 text-red-200 text-center">Por favor, introduce un enlace.</div>`;
          return;
        }

        resultsContainer.innerHTML = `<div class="p-3 rounded-xl bg-gray-700 bg-opacity-50 text-gray-200 text-center">Generando enlace, por favor espera...</div>`;
        generateButton.disabled = true;
        generateButton.querySelector('span').textContent = 'Procesando...';

        try {
          const apiUrl = `/api/generate?url=${encodeURIComponent(url)}`;
          const response = await fetch(apiUrl);
          const data = await response.json();

          if (!response.ok) {
            throw new Error(data.error || 'Ocurrió un error desconocido.');
          }
          
          displayResults(data, url); // Pasamos la URL original para la detección

        } catch (error) {
          console.error('Error en fetch:', error);
          resultsContainer.innerHTML = `<div class="p-3 rounded-xl bg-red-900 bg-opacity-50 border border-red-500 text-red-200 text-center">Error: ${error.message}</div>`;
        } finally {
          generateButton.disabled = false;
          generateButton.querySelector('span').textContent = 'Generar Enlace';
        }
      });

      function displayResults(data, originalUrl) {
        let htmlContent = '';
        
        // --- NUEVA LÓGICA DE DETECCIÓN DE GOFILE ---
        const isGofile = originalUrl.includes('gofile.io');
        const gofileWarning = `
          <div class="p-2 mt-3 text-xs text-center text-amber-400 bg-amber-900 bg-opacity-50 rounded-lg border border-amber-700">
            <strong>Aviso de GoFile:</strong> Este enlace requiere una cookie de autorización. Puede que no funcione en gestores de descarga. Se recomienda descargar directamente desde el navegador.
          </div>`;

        // CASO 1: Es una carpeta con múltiples archivos
        if (data && Array.isArray(data.contents)) {
          htmlContent = `
            <div class="p-4 rounded-xl bg-[#21284a] border border-[#3b4754] text-white text-left">
              <h3 class="font-bold text-xl mb-4 text-center">${data.title || 'Contenido de la Carpeta'}</h3>
              <ul class="flex flex-col gap-3 max-h-60 overflow-y-auto pr-2">`;
          
          data.contents.forEach(file => {
            htmlContent += `
              <li class="p-3 bg-[#101323] rounded-lg flex justify-between items-center gap-2">
                <span class="truncate text-sm">${file.filename}</span>
                <a href="${file.url}" target="_blank" class="flex-shrink-0 rounded-md bg-[#607afb] hover:bg-opacity-80 transition-colors py-1 px-3 text-xs font-semibold">Descargar</a>
              </li>`;
          });

          htmlContent += `</ul>`;
          if (isGofile) htmlContent += gofileWarning; // Añadir advertencia si es GoFile
          htmlContent += `</div>`;
        
        // CASO 2: Es un solo enlace
        } else {
            const link = (typeof data === 'string') ? data : (data.url || (Array.isArray(data) ? data[0] : null));
            const fileName = data.filename || 'Enlace Directo';
            
            if (link) {
                htmlContent = `
                <div class="flex items-stretch justify-between gap-4 rounded-xl bg-[#21284a] p-4 border border-[#3b4754]">
                    <div class="flex flex-col gap-3 flex-1">
                        <div class="flex flex-col gap-1">
                            <p class="text-white text-base font-bold leading-tight">${fileName}</p>
                        </div>
                        <div class="flex flex-wrap gap-2">
                            <a href="${link}" target="_blank" class="flex-grow min-w-max cursor-pointer items-center justify-center flex overflow-hidden rounded-xl h-9 px-4 bg-[#607afb] hover:bg-opacity-80 transition-colors text-white text-sm font-medium leading-normal">Descargar Directo</a>
                            <button onclick="copiarAlPortapapeles('${link}')" class="flex-grow min-w-max cursor-pointer items-center justify-center flex overflow-hidden rounded-xl h-9 px-4 bg-gray-600 hover:bg-gray-500 transition-colors text-white text-sm font-medium leading-normal">Copiar Enlace</button>
                        </div>
                    </div>
                </div>`;
                if (isGofile) htmlContent += gofileWarning; // Añadir advertencia si es GoFile
            } else {
                 htmlContent = `<div class="p-3 rounded-xl bg-red-900 bg-opacity-50 border border-red-500 text-red-200 text-center">Error: La respuesta de la API no tuvo un formato reconocible.</div>`;
            }
        }
        resultsContainer.innerHTML = htmlContent;
      }

      function copiarAlPortapapeles(texto) {
        if (!texto || texto === 'undefined') {
            alert('Error: No hay enlace que copiar.');
            return;
        }
        navigator.clipboard.writeText(texto).then(() => {
          alert('¡Enlace copiado al portapapeles!');
        }).catch(err => {
          console.error('Error al copiar:', err);
          alert('No se pudo copiar el enlace.');
        });
      }
    </script>
  </body>
</html>